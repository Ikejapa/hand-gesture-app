<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Hand Gesture Art - ハンドジェスチャーアート</title>
    <link rel="stylesheet" href="styles.css">
    <!-- MediaPipe Hand Tracking -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- ヘッダー -->
    <header>
        <div class="header-left">
            <div class="app-title">
                <img src="icon.png" alt="おててでアート" class="app-icon">
                <div class="title-text">
                    <div style="display: flex; align-items: baseline; gap: 8px;">
                        <h1>おててでアート</h1>
                        <span class="version">v1.0.4</span>
                    </div>
                    <p class="subtitle">手の動きで描く、新しいアート体験</p>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="status-info">
                <div class="status-item">
                    <span class="status-label">カメラ:</span>
                    <span id="headerCameraStatus" class="status-value">待機中</span>
                </div>
                <div class="status-item">
                    <span class="status-label">手の検出:</span>
                    <span id="headerHandStatus" class="status-value">なし</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ジェスチャー:</span>
                    <span id="headerGestureStatus" class="status-value">待機中</span>
                </div>
            </div>
        </div>
    </header>

    <!-- メインコンテナ -->
    <main class="container">
        <!-- キャンバスエリア -->
        <div class="canvas-container">
            <canvas id="drawingCanvas"></canvas>
            <canvas id="handCanvas"></canvas>
            <canvas id="segmentationCanvas"></canvas>
            <video id="inputVideo" style="display: none;" playsinline autoplay muted></video>
            <!-- iOS用カメラ開始ボタン -->
            <div id="startCameraButton" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
                <button onclick="manualStartCamera()" style="padding: 20px 40px; font-size: 18px; background: #5EABD6; color: white; border: none; border-radius: 10px; cursor: pointer;">
                    カメラを開始
                </button>
            </div>
        </div>

        <!-- コントロールパネル -->
        <div class="controls">
            <div class="control-group">
                <h3>モード選択</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="draw">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                        </svg>
                        <span>描画</span>
                    </button>
                    <button class="mode-btn" data-mode="particle">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path d="M14.43 10L12 2l-2.43 8H2l6.18 4.41L5.83 22 12 17.31 18.18 22l-2.35-7.59L22 10h-7.57z"/>
                        </svg>
                        <span>パーティクル</span>
                    </button>
                </div>
            </div>

            <div class="control-group">
                <h3>ペンの設定</h3>
                <div class="pen-controls">
                    <div class="color-picker">
                        <label>色</label>
                        <div class="color-options">
                            <button class="color-btn active" data-color="#F15C5C" style="background: #F15C5C"></button>
                            <button class="color-btn" data-color="#45C2B0" style="background: #45C2B0"></button>
                            <button class="color-btn" data-color="#3CB4CF" style="background: #3CB4CF"></button>
                            <button class="color-btn" data-color="#8DD3B6" style="background: #8DD3B6"></button>
                            <button class="color-btn" data-color="#FBE29E" style="background: #FBE29E"></button>
                            <button class="color-btn" data-color="#96CDEA" style="background: #96CDEA"></button>
                            <button class="color-btn" data-color="#FFA94D" style="background: #FFA94D"></button>
                            <button class="color-btn" data-color="#B197FC" style="background: #B197FC"></button>
                        </div>
                    </div>
                    <div class="size-control">
                        <label for="brushSize">太さ: <span id="sizeValue">5</span></label>
                        <input type="range" id="brushSize" min="1" max="50" value="5">
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>カメラ設定</h3>
                <div class="action-buttons">
                    <button id="blurToggleBtn" class="action-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7.07 18.28c.43-.9 3.05-1.78 4.93-1.78s4.51.88 4.93 1.78C15.57 19.36 13.86 20 12 20s-3.57-.64-4.93-1.72zm11.29-1.45c-1.43-1.74-4.9-2.33-6.36-2.33s-4.93.59-6.36 2.33C4.62 15.49 4 13.82 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8c0 1.82-.62 3.49-1.64 4.83z"/>
                        </svg>
                        <span id="blurToggleText">ぼかし ON</span>
                    </button>
                </div>
            </div>
            
            <div class="control-group">
                <h3>編集</h3>
                <div class="action-buttons">
                    <button id="undoBtn" class="action-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
                        </svg>
                        元に戻す
                    </button>
                    <button id="redoBtn" class="action-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/>
                        </svg>
                        やり直し
                    </button>
                </div>
            </div>
            
            <div class="control-group">
                <h3>アクション</h3>
                <div class="action-buttons">
                    <button id="clearBtn" class="action-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                        クリア
                    </button>
                    <button id="saveBtn" class="action-btn">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/>
                        </svg>
                        保存
                    </button>
                </div>
            </div>
        </div>

    </main>


    <!-- JavaScript -->
    <script src="app.js"></script>
</body>
</html>